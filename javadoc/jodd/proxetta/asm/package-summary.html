<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<title>jodd.proxetta.asm (Jodd API Documentation)</title>
<link rel="stylesheet" type="text/css" href="../../../jodd.css" title="Style">
<script type="text/javascript" src="../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="jodd.proxetta.asm (Jodd API Documentation)";
        }
    }
    catch(err) {
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../jodd/proxetta/advice/package-summary.html">Prev&nbsp;Package</a></li>
<li><a href="../../../jodd/proxetta/impl/package-summary.html">Next&nbsp;Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?jodd/proxetta/asm/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<div class="header">
<h1 title="Package" class="title">Package&nbsp;jodd.proxetta.asm</h1>
<div class="docSummary">
<div class="block">
 This package assembles proxy classes.</div>
</div>
<p>See:&nbsp;<a href="#package.description">Description</a></p>
</div>
<div class="contentContainer">
<ul class="blockList">
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Class Summary table, listing classes, and an explanation">
<caption><span>Class Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Class</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../jodd/proxetta/asm/AnnotationReader.html" title="class in jodd.proxetta.asm">AnnotationReader</a></td>
<td class="colLast">
<div class="block">Reads annotation inner data.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../jodd/proxetta/asm/InvokeClassBuilder.html" title="class in jodd.proxetta.asm">InvokeClassBuilder</a></td>
<td class="colLast">
<div class="block">Invocation replacer class adapter.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../jodd/proxetta/asm/InvokeReplacerMethodAdapter.html" title="class in jodd.proxetta.asm">InvokeReplacerMethodAdapter</a></td>
<td class="colLast">
<div class="block">Invocation replacer method adapter.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../jodd/proxetta/asm/MethodSignatureVisitor.html" title="class in jodd.proxetta.asm">MethodSignatureVisitor</a></td>
<td class="colLast">
<div class="block">Resolves method signature and holds all information.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../jodd/proxetta/asm/ProxettaAsmUtil.html" title="class in jodd.proxetta.asm">ProxettaAsmUtil</a></td>
<td class="colLast">
<div class="block">Various ASM utilities used by <a href="../../../jodd/proxetta/Proxetta.html" title="class in jodd.proxetta"><code>Proxetta</code></a>.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../jodd/proxetta/asm/ProxettaClassBuilder.html" title="class in jodd.proxetta.asm">ProxettaClassBuilder</a></td>
<td class="colLast">
<div class="block">Proxetta class builder.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../jodd/proxetta/asm/ProxettaCtorBuilder.html" title="class in jodd.proxetta.asm">ProxettaCtorBuilder</a></td>
<td class="colLast">
<div class="block">Destination ctor builder</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../jodd/proxetta/asm/ProxettaMethodBuilder.html" title="class in jodd.proxetta.asm">ProxettaMethodBuilder</a></td>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../jodd/proxetta/asm/ProxettaWrapperClassBuilder.html" title="class in jodd.proxetta.asm">ProxettaWrapperClassBuilder</a></td>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../jodd/proxetta/asm/TargetClassInfoReader.html" title="class in jodd.proxetta.asm">TargetClassInfoReader</a></td>
<td class="colLast">
<div class="block">Reads info from target class.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../jodd/proxetta/asm/TypeInfoImpl.html" title="class in jodd.proxetta.asm">TypeInfoImpl</a></td>
<td class="colLast">
<div class="block">Implementation of <a href="../../../jodd/proxetta/TypeInfo.html" title="interface in jodd.proxetta"><code>TypeInfo</code></a>.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../jodd/proxetta/asm/WorkData.html" title="class in jodd.proxetta.asm">WorkData</a></td>
<td class="colLast">
<div class="block">Holds various information about the current process of making proxy.</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
<a name="package.description">
<!--   -->
</a>
<h2 title="Package jodd.proxetta.asm Description">Package jodd.proxetta.asm Description</h2>
<div class="block"><p>
 This package assembles proxy classes. You will probably like to keep out from this code:)
 </p>
 <h2>Replacements and modification rules</h2>
 <p>
 During creation of proxy methods, several replacement and modification happens in order to produce valid proxy subclass.
 Here is the list of all such rules.
 </p>
 <h3>Add all constructors [A1]</h3>
 <p>
 Proxy subclass must contain all constructors as target subclass. New constructors simply
 delegates invocation to the super class. All constructor annotations are copied.
 </p>
 <h3>Add the last method in chain [A2]</h3>
 <p>
 Last method in proxy chain is the one that simply delegates the invocation to the target method in super class.
 </p>
 <h3>Add all type annotations [A3]</h3>
 <p>
 Proxy subclass must contain all type annotations as the target one.
 </p>
 <h3>Copy all annotations to the first method in proxy method chain [A4]</h3>
 <p>
 Proxy methods must contain all type annotations as the target one.
 </p>
 <h3>Fix the offset of local variables [F1]</h3>
 <p>
 Offset of all local variables has to be incremented by the <em>size</em> of target method argument list.
 Size of arguments list is the number of 32bit words used by arguments on stack, which means that
 all types has length of 1 word, except <code>Long</code> and <code>Double</code> that weight 2 words
 (or one dword).
 </p>
 <div style="width:100px;float:left; border:1px solid gray; margin-right:10px">
 <pre>
 iconst_1
 istore_1
 </pre>
 </div>
 <div style="width:100px;float:left; border:1px solid gray;">
 <pre>
 iconst_1
 istore_13
 </pre>
 </div>
 <p style="clear:both">
 Here is the order of local variables:</p>
 <ul>
 <li>0 - always 'this'</li>
 <li>arguments (if exist)</li>
 <li>locals (if exist)</li>
 </ul>
 <p>
 Therefore, index 0 is left as it is and offset will not be added to it.
 </p>
 <br style="clear:both;">
 <h3>Replace ProxyTarget.argsCount [R2]</h3>
 <p>
 Call to <code>ProxyTarget.argsCount()</code> has to be replaces with hardcoded arguments count.
 Method call is simply replaces with appropriate load instruction: <code>iload_n</code> where n is in [0. 5];
 <code>bipush n</code> where n is in byte range; or <code>sipush n</code> when n is in integer range.
 </p>
 <br>
 <h3>Replace ProxyTarget.getArgType [R3]</h3>
 <p>
 Call to <code>ProxyTarget.getArgType(int )</code>      has to be replaces with hardcoded argument Class, where argument
 index is provided as an argument for <code>ProxyTarget.getArgType(int )</code>.
 Method call is replaced with <code>getClass()</code> call on specified argument. If argument is an primitive
 then method is replaced with reading the <code>TYPE</code> attribute of appropriate wrapper.
 </p>
 <p>
 One caveat: opcode for pushing argument offset to stack is not removed from the bytecode,
 due to performance issues of class creation. Instead, this value is poped from the stack before method call is replaced.
 It is assumed that this value is an integer.
 </p>
 <div style="width:400px;float:left; border:1px solid gray; margin-right:10px">
 <pre>
 iconst_1
 invokestatic package/ProxyTarget.getArgClass
 astore_1
 iconst_2
 invokestatic package/ProxyTarget.getArgClass
 astore_2
 </pre>
 </div>
 <div style="width:400px;float:left; border:1px solid gray;">
 <pre>
 (iconst_1
 pop)
 aload_1
 invokevirtual java/lang/Object.getClass
 astore 13
 (iconst_2
 pop)
 getstatic java/lang/Byte.TYPE
 astore 14
 </pre>
 </div>
 <br style="clear:both;">
 <h3>Replace ProxyTarget.getArg [R4]</h3>
 <p>
 Call to <code>ProxyTarget.getArg(int )</code> has to be replaces with hardcoded argument value, where
 index is provided as an argument for <code>ProxyTarget.getArg(int )</code>.
 If argument is a primitive, its wrapper object will be created.
 </p>
 <div style="width:400px;float:left; border:1px solid gray; margin-right:10px">
 <pre>
 iconst_1
 invokestatic package/ProxyTarget.getArg
 astore_1
 bipush 6
 invokestatic package/ProxyTarget.getArg
 astore_3
 </pre>
 </div>
 <div style="width:400px;float:left; border:1px solid gray;">
 <pre>
 aload_1
 astore_13
 lload 6
 invokestatic java/lang/Long.&lt;init&gt;
 astore 14
 </pre>
 </div>
 <br style="clear:both;">
 <h3>Replace ProxyTarget.setArg [R5]</h3>
 <p>
 Call to <code>ProxyTarget.setArg(Object, int )</code> has to be replaces with hardcoded setting of the argument value,
 where index is provided as an argument for <code>ProxyTarget.setArg(Object, int )</code>.
 If argument is a primitive, its wrapper object must be provided.
 </p>
 <h3>Replace ProxyTarget.createArgsArray [R6]</h3>
 <p>
 Call to <code>ProxyTarget.createArgsArray()</code> has to be replaces with hardcoded creation of an object array,
 where elements are target method arguments. Primitive arguments are wrapped.
 </p>
 <h3>Replace ProxyTarget.invoke [R7]</h3>
 <p>
 Call to <code>ProxyTarget.invokeAndGetResult()</code> has to be replaced with call to super target method. Since target methods
 may have one or more arguments, it is required to push all arguments to the stack prior to call of super target method.
 Note that <code>aload_0</code> is always the first instruction (load <code>this</code>), no matter how many arguments there are.
 </p>
 <div style="width:400px;float:left; border:1px solid gray; margin-right:10px">
 <pre>
 invokestatic package/ProxyTarget.invoke
 </pre>
 </div>
 <div style="width:300px;float:left; border:1px solid gray;">
 <pre>
 aload_0
 aload_1
 iload_2
 ...
 invokespecial package/Target.method
 </pre>
 </div>
 <p>
 Situation here is a bit more complicated since return value must be provided, so the following fixes has to be
 applied, too.
 </p>
 <h3>Fix POP for ProxyTarget.invoke [F3]</h3>
 <p>
 When <code>ProxyTarget.invoke()</code> is invoked without assignment, <code>POP/POP2</code> instruction
 is added afterwards, to remove the value from the stack. For targets that do not return void, this opcode
 has to be fixed, i.e. removed. (Fact is that targets that return void, do not have POP:).
 </p>
 <h3>Fix return value and Fix ASTORE for ProxyTarget.invoke [F4]</h3>
 <p>
 When <code>ProxyTarget.invoke()</code> is invoked with assignment, <code>xSTORE</code> instruction
 is added afterwards, to assign return value to a local variable. Therefore, it has to be loaded again on stack
 before return.
 </p>
 <p>Creates all return values, performs casting for small types.</p>
 <h3>Replace ProxyTarget.getTargetClass [R9]</h3>
 <p>
 Returns the target class.
 </p>
 <h3>Replace ProxyTarget.getTargetMethodName [R10]</h3>
 <p>
 Returns target method name.
 </p>
 <h3>Replace ProxyTarget.getReturnType [R11]</h3>
 <p>
 Returns return type of the target method or <code>null</code> if metod returns void.
 </p>
 <h3>Fix field access [F5]</h3>
 <p>
 Access to advice's fields has to be replaced with access to local fields. In relation with [A5].
 </p>
 <h3>Copy advice's fields to proxy [A5]</h3>
 <p>
 All fields from advice has to be copied to proxy, with proxy index added to the name, to prevent duplicate names.
 </p>
 <h3>Copy and fix advice static constructor [A6/F6]</h3>
 <p>
 Static block of an advice should be copied to the proxy, with fixed field access (see F5).
 </p>
 <h3>Copy and fix advices default constructors [A7/F7]</h3>
 <p>
 Advice's constructor will be copied to regular methods, except first two instructions (calling super constructor) will be
 ignored. Field access will be fixed (see F5).
 </p></div>
</div>
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../jodd/proxetta/advice/package-summary.html">Prev&nbsp;Package</a></li>
<li><a href="../../../jodd/proxetta/impl/package-summary.html">Next&nbsp;Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?jodd/proxetta/asm/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2003-present <a href="http://jodd.org">Jodd Team</a></small></p>
</body>
</html>
